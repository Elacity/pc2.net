# PC2 Architecture Diagrams
# PC2 架构图

---

## 1. Overall System Architecture / 整体系统架构

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                                                                           ║
║                              USER / 用户                                  ║
║                                 👤                                         ║
║                                 │                                          ║
║                                 │ Login with Wallet                        ║
║                                 │ 使用钱包登录                              ║
║                                 ▼                                          ║
║  ┌─────────────────────────────────────────────────────────────────────┐  ║
║  │                                                                     │  ║
║  │                     ELASTOS BROWSER UI                              │  ║
║  │                     ElastOS 浏览器界面                               │  ║
║  │                                                                     │  ║
║  │  ┌─────────────────┐    ┌─────────────────┐    ┌───────────────┐   │  ║
║  │  │                 │    │                 │    │               │   │  ║
║  │  │  Particle Auth  │───▶│ WalletService   │───▶│  PC2 Module   │   │  ║
║  │  │  Extension      │    │                 │    │  Extension    │   │  ║
║  │  │  粒子认证扩展    │    │  钱包服务       │    │  PC2 模块扩展  │   │  ║
║  │  │                 │    │                 │    │               │   │  ║
║  │  │  • Social Login │    │  • EOA Address  │    │  • Connect    │   │  ║
║  │  │  • MetaMask     │    │  • Tokens       │    │  • Storage    │   │  ║
║  │  │  • WalletConnect│    │  • Balance      │    │  • Compute    │   │  ║
║  │  │                 │    │                 │    │               │   │  ║
║  │  └─────────────────┘    └────────┬────────┘    └───────┬───────┘   │  ║
║  │                                  │                     │           │  ║
║  └──────────────────────────────────┼─────────────────────┼───────────┘  ║
║                                     │                     │              ║
║                                     │ EOA Address         │ Connect      ║
║                                     │ EOA 地址            │ 连接         ║
║                                     ▼                     ▼              ║
║                          ┌─────────────────────────────────────┐         ║
║                          │                                     │         ║
║                          │   IDENTITY / 身份                   │         ║
║                          │   0x34DAF31B99B5A59cEB18E424...     │         ║
║                          │                                     │         ║
║                          └──────────────────┬──────────────────┘         ║
║                                             │                            ║
║                                             │ Authenticated Request      ║
║                                             │ 认证请求                    ║
║                                             ▼                            ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                   INTERNET                               ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                             │                            ║
║                                             ▼                            ║
║  ┌─────────────────────────────────────────────────────────────────────┐  ║
║  │                                                                     │  ║
║  │            PERSONAL HARDWARE BOX / 个人硬件盒子                      │  ║
║  │                                                                     │  ║
║  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────────┐  │  ║
║  │  │   Storage   │  │   Compute   │  │  Networking │  │  Database │  │  ║
║  │  │   Node      │  │   Node      │  │   Node      │  │   Node    │  │  ║
║  │  │   存储节点   │  │   计算节点   │  │   网络节点   │  │  数据库节点 │  │  ║
║  │  └─────────────┘  └─────────────┘  └─────────────┘  └───────────┘  │  ║
║  │                                                                     │  ║
║  │  Owner Identity: 0x34DAF31B99B5A59cEB18E424...                      │  ║
║  │  所有者身份: 0x34DAF31B99B5A59cEB18E424...                          │  ║
║  │                                                                     │  ║
║  └─────────────────────────────────────────────────────────────────────┘  ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 2. Authentication Flow / 认证流程

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                       AUTHENTICATION FLOW / 认证流程                       ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║  User        Browser         Particle         Hardware Box                ║
║  用户        浏览器          Particle          硬件盒子                    ║
║   │            │               │                   │                      ║
║   │ ①Click     │               │                   │                      ║
║   │ Login      │               │                   │                      ║
║   │──────────▶│               │                   │                      ║
║   │            │               │                   │                      ║
║   │            │ ②Show Modal   │                   │                      ║
║   │            │──────────────▶│                   │                      ║
║   │            │               │                   │                      ║
║   │◀───────────────────────────│                   │                      ║
║   │ ③Choose Wallet/Social      │                   │                      ║
║   │                            │                   │                      ║
║   │ ④Sign Message              │                   │                      ║
║   │──────────────────────────▶│                   │                      ║
║   │                            │                   │                      ║
║   │            │◀──────────────│                   │                      ║
║   │            │ ⑤EOA Address  │                   │                      ║
║   │            │   0x34DA...   │                   │                      ║
║   │            │               │                   │                      ║
║   │            │ ⑥Store in     │                   │                      ║
║   │            │ WalletService │                   │                      ║
║   │            │               │                   │                      ║
║   │            │ ⑦Request Challenge               │                      ║
║   │            │──────────────────────────────────▶│                      ║
║   │            │                                   │                      ║
║   │            │◀──────────────────────────────────│                      ║
║   │            │ ⑧{ challenge: "xyz123" }          │                      ║
║   │            │                                   │                      ║
║   │◀───────────│                                   │                      ║
║   │ ⑨Sign Challenge                               │                      ║
║   │────────────▶                                   │                      ║
║   │            │                                   │                      ║
║   │            │ ⑩Send Signature                  │                      ║
║   │            │──────────────────────────────────▶│                      ║
║   │            │                                   │                      ║
║   │            │                                   │ ⑪Verify:             ║
║   │            │                                   │ recover(sig)==EOA?   ║
║   │            │                                   │                      ║
║   │            │◀──────────────────────────────────│                      ║
║   │            │ ⑫{ token: "jwt...", ok: true }   │                      ║
║   │            │                                   │                      ║
║   │◀───────────│                                   │                      ║
║   │ ⑬Connected to Personal Cloud!                 │                      ║
║   │   已连接到个人云！                             │                      ║
║   │            │                                   │                      ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 3. Extension System Architecture / 扩展系统架构

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    EXTENSION SYSTEM / 扩展系统                            ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║  ┌─────────────────────────────────────────────────────────────────────┐  ║
║  │                      PUTER CORE / Puter 核心                        │  ║
║  │                                                                     │  ║
║  │  ┌─────────────────────────────────────────────────────────────┐   │  ║
║  │  │                  Extension Manager / 扩展管理器               │   │  ║
║  │  │                                                             │   │  ║
║  │  │  • Loads extensions / 加载扩展                               │   │  ║
║  │  │  • Manages lifecycle / 管理生命周期                          │   │  ║
║  │  │  • Routes requests / 路由请求                                │   │  ║
║  │  │                                                             │   │  ║
║  │  └───────────────────────────┬─────────────────────────────────┘   │  ║
║  │                              │                                     │  ║
║  └──────────────────────────────┼─────────────────────────────────────┘  ║
║                                 │                                        ║
║            ┌────────────────────┼────────────────────┐                   ║
║            │                    │                    │                   ║
║            ▼                    ▼                    ▼                   ║
║  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          ║
║  │                 │  │                 │  │                 │          ║
║  │  particle-auth  │  │  ipfs-storage   │  │   pc2-cloud     │          ║
║  │    Extension    │  │   Extension     │  │   Extension     │          ║
║  │   粒子认证扩展   │  │   IPFS存储扩展   │  │   PC2云扩展     │          ║
║  │                 │  │                 │  │                 │          ║
║  │  ✅ COMPLETE    │  │  📖 REFERENCE   │  │  🔨 TO BUILD    │          ║
║  │  ✅ 已完成      │  │  📖 仅供参考    │  │  🔨 待构建      │          ║
║  │                 │  │                 │  │                 │          ║
║  │  • Auth driver  │  │  • Storage      │  │  • Cloud driver │          ║
║  │  • GUI service  │  │    pattern      │  │  • Storage      │          ║
║  │  • Routes       │  │  • IPFS         │  │  • Compute      │          ║
║  │                 │  │    provider     │  │  • Networking   │          ║
║  │                 │  │                 │  │                 │          ║
║  └─────────────────┘  └─────────────────┘  └─────────────────┘          ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 4. EOA vs Smart Account / EOA 与智能账户对比

```
╔═══════════════════════════════════════════════════════════════════════════╗
║              EOA vs SMART ACCOUNT / EOA 与智能账户对比                     ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║  ┌─────────────────────────────────────────────────────────────────────┐  ║
║  │                                                                     │  ║
║  │  EOA (Externally Owned Account) ✅ USE FOR PC2                      │  ║
║  │  EOA（外部拥有账户）✅ 用于 PC2                                      │  ║
║  │                                                                     │  ║
║  │  ┌───────────────────────────────────────────────────────────────┐ │  ║
║  │  │                                                               │ │  ║
║  │  │   Address: 0x34DAF31B99B5A59cEB18E424Dbc112FA6e5f3Dc3        │ │  ║
║  │  │   地址                                                        │ │  ║
║  │  │                                                               │ │  ║
║  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │ │  ║
║  │  │   │  Ethereum   │ │   Elastos   │ │   Polygon   │            │ │  ║
║  │  │   │  以太坊     │ │   Elastos   │ │   Polygon   │            │ │  ║
║  │  │   │             │ │             │ │             │            │ │  ║
║  │  │   │  SAME ADDR  │ │  SAME ADDR  │ │  SAME ADDR  │            │ │  ║
║  │  │   │  相同地址   │ │  相同地址   │ │  相同地址   │            │ │  ║
║  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │ │  ║
║  │  │                                                               │ │  ║
║  │  │   • Controlled by private key / 由私钥控制                    │ │  ║
║  │  │   • Same address everywhere / 各处地址相同                    │ │  ║
║  │  │   • Perfect for identity / 非常适合作为身份                   │ │  ║
║  │  │                                                               │ │  ║
║  │  └───────────────────────────────────────────────────────────────┘ │  ║
║  │                                                                     │  ║
║  └─────────────────────────────────────────────────────────────────────┘  ║
║                                                                           ║
║  ┌─────────────────────────────────────────────────────────────────────┐  ║
║  │                                                                     │  ║
║  │  SMART ACCOUNT (Universal Account) ❌ DO NOT USE FOR PC2           │  ║
║  │  智能账户（通用账户）❌ 不要用于 PC2                                │  ║
║  │                                                                     │  ║
║  │  ┌───────────────────────────────────────────────────────────────┐ │  ║
║  │  │                                                               │ │  ║
║  │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │ │  ║
║  │  │   │  Ethereum   │ │    Base     │ │   Arbitrum  │            │ │  ║
║  │  │   │  以太坊     │ │    Base     │ │   Arbitrum  │            │ │  ║
║  │  │   │             │ │             │ │             │            │ │  ║
║  │  │   │  0x7Efe...  │ │  0x8Abc...  │ │  0x9Def...  │            │ │  ║
║  │  │   │  DIFFERENT! │ │  DIFFERENT! │ │  DIFFERENT! │            │ │  ║
║  │  │   │  不同!      │ │  不同!      │ │  不同!      │            │ │  ║
║  │  │   └─────────────┘ └─────────────┘ └─────────────┘            │ │  ║
║  │  │                                                               │ │  ║
║  │  │   • Contract-based / 基于合约                                 │ │  ║
║  │  │   • Different address per chain / 每条链地址不同             │ │  ║
║  │  │   • Only for multi-chain tokens / 仅用于多链代币              │ │  ║
║  │  │                                                               │ │  ║
║  │  └───────────────────────────────────────────────────────────────┘ │  ║
║  │                                                                     │  ║
║  └─────────────────────────────────────────────────────────────────────┘  ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 5. Data Flow / 数据流

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                         DATA FLOW / 数据流                                ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║   CURRENT (Centralized) ──────────▶ TARGET (Decentralized)               ║
║   当前（中心化）                     目标（去中心化）                      ║
║                                                                           ║
║   ┌───────────┐                      ┌───────────┐                        ║
║   │  Browser  │                      │  Browser  │                        ║
║   │  浏览器   │                      │  浏览器   │                        ║
║   └─────┬─────┘                      └─────┬─────┘                        ║
║         │                                  │                              ║
║         │ All requests                     │ Identity (EOA)               ║
║         │ 所有请求                         │ 身份 (EOA)                   ║
║         ▼                                  ▼                              ║
║   ┌───────────┐                      ┌───────────┐                        ║
║   │  Puter    │                      │   PC2     │                        ║
║   │  Cloud    │                      │ Extension │                        ║
║   │  中心云   │                      │  PC2 扩展 │                        ║
║   └─────┬─────┘                      └─────┬─────┘                        ║
║         │                                  │                              ║
║         │                                  │ Authenticated                ║
║         │                                  │ 已认证                       ║
║         ▼                                  ▼                              ║
║   ┌───────────┐                      ┌───────────┐                        ║
║   │  Puter    │                      │  Personal │                        ║
║   │  Servers  │                      │  Hardware │                        ║
║   │  Puter    │                      │    Box    │                        ║
║   │  服务器   │                      │ 个人硬件  │                        ║
║   └───────────┘                      └───────────┘                        ║
║                                                                           ║
║   ❌ Centralized                     ✅ Decentralized                     ║
║   ❌ 中心化                          ✅ 去中心化                          ║
║   ❌ Company controls data           ✅ User controls data                ║
║   ❌ 公司控制数据                    ✅ 用户控制数据                       ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 6. PC2 Extension File Structure / PC2 扩展文件结构

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    PC2 EXTENSION STRUCTURE / PC2 扩展结构                  ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║   extensions/                                                             ║
║   │                                                                       ║
║   ├── particle-auth/           ◄── REFERENCE (Copy pattern)              ║
║   │   │                            参考（复制模式）                        ║
║   │   ├── main.js                                                        ║
║   │   ├── drivers/                                                       ║
║   │   ├── services/                                                      ║
║   │   └── routes/                                                        ║
║   │                                                                       ║
║   ├── ipfs-storage/            ◄── REFERENCE ONLY (Don't use)            ║
║   │   │                            仅供参考（不要使用）                    ║
║   │   └── ...                                                            ║
║   │                                                                       ║
║   └── pc2-cloud/               ◄── CREATE THIS (DePin team)              ║
║       │                            创建这个（DePin 团队）                  ║
║       │                                                                   ║
║       ├── main.js              ◄── Extension entry                       ║
║       │                            扩展入口                               ║
║       │                                                                   ║
║       ├── drivers/                                                        ║
║       │   │                                                              ║
║       │   ├── PC2CloudDriver.js    ◄── Cloud connection                  ║
║       │   │                            云连接                             ║
║       │   │                                                              ║
║       │   ├── PC2StorageDriver.js  ◄── Replace Puter storage             ║
║       │   │                            替换 Puter 存储                    ║
║       │   │                                                              ║
║       │   └── PC2ComputeDriver.js  ◄── Optional: Compute tasks           ║
║       │                                可选：计算任务                     ║
║       │                                                                   ║
║       ├── services/                                                       ║
║       │   │                                                              ║
║       │   └── PC2Service.js        ◄── Communication with box            ║
║       │                                与硬件盒子通信                     ║
║       │                                                                   ║
║       ├── routes/                                                         ║
║       │   │                                                              ║
║       │   └── pc2.js               ◄── API endpoints                     ║
║       │                                API 端点                          ║
║       │                                                                   ║
║       └── package.json                                                    ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## Summary / 总结

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                                                                           ║
║                           KEY POINTS / 关键点                             ║
║                                                                           ║
║   ┌───────────────────────────────────────────────────────────────────┐   ║
║   │                                                                   │   ║
║   │  1. User identity = EOA address (0x...)                          │   ║
║   │     用户身份 = EOA 地址 (0x...)                                   │   ║
║   │                                                                   │   ║
║   │  2. Get EOA: walletService.getEOAAddress()                       │   ║
║   │     获取 EOA: walletService.getEOAAddress()                      │   ║
║   │                                                                   │   ║
║   │  3. Hardware box verifies EOA ownership via signature            │   ║
║   │     硬件盒子通过签名验证 EOA 所有权                               │   ║
║   │                                                                   │   ║
║   │  4. Follow particle-auth extension pattern                       │   ║
║   │     遵循 particle-auth 扩展模式                                   │   ║
║   │                                                                   │   ║
║   │  5. PC2 extension replaces centralized Puter services            │   ║
║   │     PC2 扩展替换中心化 Puter 服务                                 │   ║
║   │                                                                   │   ║
║   └───────────────────────────────────────────────────────────────────┘   ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

