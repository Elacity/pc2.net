# DePIN 集成指南 - Elastos 个人云操作系统

## 概述

本文档提供了将 Elastos 个人云操作系统连接到 DePIN 硬件盒子所需的集成接口。目标是用用户自己的 IPFS 存储替代 Puter 的中心化云服务。

## 架构

```
┌─────────────────────────────────────────────────────────────┐
│                Elastos 云操作系统 (前端)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  UI/桌面    │  │   应用程序   │  │     文件浏览器      │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
│         │                │                     │             │
│         └────────────────┼─────────────────────┘             │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   存储抽象层                           │  │
│  │         StorageProvider 接口 (见下方接口)              │  │
│  └───────────────────────┬───────────────────────────────┘  │
└──────────────────────────┼──────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────────┐
│                      DePIN 硬件盒子                           │
│  ┌────────────┐  ┌────────────┐  ┌────────────────────────┐  │
│  │   IPFS     │  │   ERC20    │  │      钱包认证          │  │
│  │   存储     │  │   代币     │  │   (DID/智能账户)       │  │
│  │   :4001    │  │            │  │                        │  │
│  └────────────┘  └────────────┘  └────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘
```

## 当前状态

### ✅ 已完成 (前端)
- Particle Network 认证（去中心化钱包登录）
- 智能账户 (ERC-4337) 支持
- 现代化 UI 和 Elastos 品牌
- 更新的图标集

### 🔄 你们团队需要实现 (后端)
- IPFS 存储提供者
- 用户文件夹初始化
- 文件读/写/删除操作
- 用于偏好设置的键值存储

## 需要实现的接口

### 1. 认证接口

```javascript
POST /auth/particle
// 请求体
{
  "address": "0x1234...",           // EOA 钱包地址
  "smartAccountAddress": "0x5678...", // ERC-4337 智能账户
  "chainId": 20,                    // Elastos Smart Chain
  "particleUuid": "uuid",
  "particleEmail": "user@email.com"
}

// 响应
{
  "token": "session_token",
  "user": {
    "uuid": "user-uuid",
    "username": "0x1234...",
    "wallet_address": "0x1234...",
    "smart_account_address": "0x5678..."
  }
}
```

### 2. 存储接口

| 接口 | 描述 |
|------|------|
| `GET /stat?path=...` | 获取文件/文件夹元数据 |
| `GET /read?path=...` | 读取文件内容 |
| `POST /write` | 写入文件内容 |
| `POST /mkdir` | 创建目录 |
| `GET /readdir?path=...` | 列出目录内容 |
| `POST /delete` | 删除文件/目录 |

### 3. 用户文件夹结构

用户登录时，在 IPFS 中初始化这些文件夹：

```
/{钱包地址}/
├── Desktop/     (桌面)
├── Documents/   (文档)
├── Pictures/    (图片)
├── Videos/      (视频)
├── Public/      (公开)
├── AppData/     (应用数据)
└── Trash/       (回收站)
```

### 4. 键值存储接口

```javascript
GET  /kv/get?key=...   // 获取偏好设置
POST /kv/set           // 设置偏好设置
```

## 配置

更新 `volatile/config/config.json` 指向你们的后端：

```json
{
  "api_origin": "http://硬件盒子IP:8080",
  "storage_provider": "ipfs",
  "ipfs_gateway": "http://硬件盒子IP:8080/ipfs"
}
```

## 集成流程

1. **你们实现后端 API** - 按照接口文档实现存储和认证
2. **配置前端** - 修改 API 地址指向你们的服务
3. **测试集成** - 确保文件操作和登录正常工作
4. **发布** - 打包并部署到硬件盒子

## 详细文档

- [StorageProvider.md](./StorageProvider.md) - 存储接口详细规范
- [AuthProvider.md](./AuthProvider.md) - 认证接口详细规范
- [KVStore.md](./KVStore.md) - 键值存储接口
- [APIEndpoints.md](./APIEndpoints.md) - 所有 API 端点汇总

## 联系方式

如有集成问题，请通过团队频道协调。

---

**注意：** 前端已准备好进行集成。你们团队实现存储层，然后我们将它们连接在一起。
