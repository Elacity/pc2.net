var z=Object.defineProperty;var x=(f,i,t)=>i in f?z(f,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[i]=t;var p=(f,i,t)=>x(f,typeof i!="symbol"?i+"":i,t);import{N as d,c as E,S as l,b as S,d as J,L as C,e as _,f as M,v as j,R as D,P as I,h as O,T as A}from"./index-8k2D3aM1.js";import{t as k,a as B,p as V,b as $,c as L,d as T,e as P}from"./date-utils-pKr_beww.js";function Q(f,i,t){if(t!=null&&t.source){const e=t.source;if(typeof i=="number"&&(i>Number.MAX_SAFE_INTEGER||i<Number.MIN_SAFE_INTEGER||e!==String(i)))return e.includes(".")?new d(e,"bigDecimal"):BigInt(e)}return i}const F=(f,i)=>E(f,i).then(t=>((i==null?void 0:i.utf8Encoder)??k)(t)),U=(f,i)=>F(f,i).then(t=>{if(t.length)try{return JSON.parse(t)}catch(e){throw(e==null?void 0:e.name)==="SyntaxError"&&Object.defineProperty(e,"$responseBodyText",{value:t}),e}return{}}),q=(f,i)=>{const t=(r,s)=>Object.keys(r).find(c=>c.toLowerCase()===s.toLowerCase()),e=r=>{let s=r;return typeof s=="number"&&(s=s.toString()),s.indexOf(",")>=0&&(s=s.split(",")[0]),s.indexOf(":")>=0&&(s=s.split(":")[0]),s.indexOf("#")>=0&&(s=s.split("#")[1]),s},o=t(f.headers,"x-amzn-errortype");if(o!==void 0)return e(f.headers[o]);if(i&&typeof i=="object"){const r=t(i,"code");if(r&&i[r]!==void 0)return e(i[r]);if(i.__type!==void 0)return e(i.__type)}};class K extends l{constructor(t){super();p(this,"settings");this.settings=t}async read(t,e){return this._read(t,typeof e=="string"?JSON.parse(e,Q):await U(e,this.serdeContext))}readObject(t,e){return this._read(t,e)}_read(t,e){const o=e!==null&&typeof e=="object",r=S.of(t);if(o){if(r.isStructSchema()){const c={};for(const[m,n]of J(r,e,this.settings.jsonName?"jsonName":!1)){const a=this.settings.jsonName?n.getMergedTraits().jsonName??m:m,h=this._read(n,e[a]);h!=null&&(c[m]=h)}return c}if(Array.isArray(e)&&r.isListSchema()){const c=r.getValueSchema(),m=[],n=!!r.getMergedTraits().sparse;for(const a of e)(n||a!=null)&&m.push(this._read(c,a));return m}if(r.isMapSchema()){const c=r.getValueSchema(),m={},n=!!r.getMergedTraits().sparse;for(const[a,h]of Object.entries(e))(n||h!=null)&&(m[a]=this._read(c,h));return m}}if(r.isBlobSchema()&&typeof e=="string")return B(e);const s=r.getMergedTraits().mediaType;if(r.isStringSchema()&&typeof e=="string"&&s)return s==="application/json"||s.endsWith("+json")?C.from(e):e;if(r.isTimestampSchema()&&e!=null)switch(_(r,this.settings)){case 5:return L(e);case 6:return $(e);case 7:return V(e);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",e),new Date(e)}if(r.isBigIntegerSchema()&&(typeof e=="number"||typeof e=="string"))return BigInt(e);if(r.isBigDecimalSchema()&&e!=null){if(e instanceof d)return e;const c=e;return c.type==="bigDecimal"&&"string"in c?new d(c.string,c.type):new d(String(e),"bigDecimal")}if(r.isNumericSchema()&&typeof e=="string"){switch(e){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return e}if(r.isDocumentSchema())if(o){const c=Array.isArray(e)?[]:{};for(const[m,n]of Object.entries(e))n instanceof d?c[m]=n:c[m]=this._read(r,n);return c}else return structuredClone(e);return e}}const N="Î";class W{constructor(){p(this,"values",new Map);p(this,"counter",0);p(this,"stage",0)}createReplacer(){if(this.stage===1)throw new Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,(i,t)=>{if(t instanceof d){const e=`${N+"nv"+this.counter++}_`+t.string;return this.values.set(`"${e}"`,t.string),e}if(typeof t=="bigint"){const e=t.toString(),o=`${N+"b"+this.counter++}_`+e;return this.values.set(`"${o}"`,e),o}return t}}replaceInJson(i){if(this.stage===0)throw new Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return i;for(const[t,e]of this.values)i=i.replace(t,e);return i}}class G extends l{constructor(t){super();p(this,"settings");p(this,"buffer");p(this,"useReplacer",!1);p(this,"rootSchema");this.settings=t}write(t,e){this.rootSchema=S.of(t),this.buffer=this._write(this.rootSchema,e)}writeDiscriminatedDocument(t,e){this.write(t,e),typeof this.buffer=="object"&&(this.buffer.__type=S.of(t).getName(!0))}flush(){const{rootSchema:t,useReplacer:e}=this;if(this.rootSchema=void 0,this.useReplacer=!1,t!=null&&t.isStructSchema()||t!=null&&t.isDocumentSchema()){if(!e)return JSON.stringify(this.buffer);const o=new W;return o.replaceInJson(JSON.stringify(this.buffer,o.createReplacer(),0))}return this.buffer}_write(t,e,o){var c,m;const r=e!==null&&typeof e=="object",s=S.of(t);if(r){if(s.isStructSchema()){const n={};for(const[a,h]of M(s,e)){const u=this._write(h,e[a],s);if(u!==void 0){const g=h.getMergedTraits().jsonName,y=this.settings.jsonName?g??a:a;n[y]=u}}return n}if(Array.isArray(e)&&s.isListSchema()){const n=s.getValueSchema(),a=[],h=!!s.getMergedTraits().sparse;for(const u of e)(h||u!=null)&&a.push(this._write(n,u));return a}if(s.isMapSchema()){const n=s.getValueSchema(),a={},h=!!s.getMergedTraits().sparse;for(const[u,g]of Object.entries(e))(h||g!=null)&&(a[u]=this._write(n,g));return a}if(e instanceof Uint8Array&&(s.isBlobSchema()||s.isDocumentSchema()))return s===this.rootSchema?e:(((c=this.serdeContext)==null?void 0:c.base64Encoder)??T)(e);if(e instanceof Date&&(s.isTimestampSchema()||s.isDocumentSchema()))switch(_(s,this.settings)){case 5:return e.toISOString().replace(".000Z","Z");case 6:return P(e);case 7:return e.getTime()/1e3;default:return console.warn("Missing timestamp format, using epoch seconds",e),e.getTime()/1e3}e instanceof d&&(this.useReplacer=!0)}if(!(e===null&&(o!=null&&o.isStructSchema()))){if(s.isStringSchema()){if(typeof e>"u"&&s.isIdempotencyToken())return j();const n=s.getMergedTraits().mediaType;return e!=null&&n&&(n==="application/json"||n.endsWith("+json"))?C.from(e):e}if(typeof e=="number"&&s.isNumericSchema())return Math.abs(e)===1/0||isNaN(e)?String(e):e;if(typeof e=="string"&&s.isBlobSchema())return s===this.rootSchema?e:(((m=this.serdeContext)==null?void 0:m.base64Encoder)??T)(e);if(typeof e=="bigint"&&(this.useReplacer=!0),s.isDocumentSchema())if(r){const n=Array.isArray(e)?[]:{};for(const[a,h]of Object.entries(e))h instanceof d?(this.useReplacer=!0,n[a]=h):n[a]=this._write(s,h);return n}else return structuredClone(e);return e}}}class Z extends l{constructor(t){super();p(this,"settings");this.settings=t}createSerializer(){const t=new G(this.settings);return t.setSerdeContext(this.serdeContext),t}createDeserializer(){const t=new K(this.settings);return t.setSerdeContext(this.serdeContext),t}}class H extends D{constructor({defaultNamespace:t,serviceTarget:e,awsQueryCompatible:o,jsonCodec:r}){super({defaultNamespace:t});p(this,"serializer");p(this,"deserializer");p(this,"serviceTarget");p(this,"codec");p(this,"mixin");p(this,"awsQueryCompatible");this.serviceTarget=e,this.codec=r??new Z({timestampFormat:{useTrait:!0,default:7},jsonName:!1}),this.serializer=this.codec.createSerializer(),this.deserializer=this.codec.createDeserializer(),this.awsQueryCompatible=!!o,this.mixin=new I(this.awsQueryCompatible)}async serializeRequest(t,e,o){const r=await super.serializeRequest(t,e,o);return r.path.endsWith("/")||(r.path+="/"),Object.assign(r.headers,{"content-type":`application/x-amz-json-${this.getJsonRpcVersion()}`,"x-amz-target":`${this.serviceTarget}.${t.name}`}),this.awsQueryCompatible&&(r.headers["x-amzn-query-mode"]="true"),(O(t.input)==="unit"||!r.body)&&(r.body="{}"),r}getPayloadCodec(){return this.codec}async handleError(t,e,o,r,s){this.awsQueryCompatible&&this.mixin.setQueryCompatError(r,o);const c=q(o,r)??"Unknown",{errorSchema:m,errorMetadata:n}=await this.mixin.getErrorSchemaOrThrowBaseException(c,this.options.defaultNamespace,o,r,s),a=S.of(m),h=r.message??r.Message??"Unknown",u=A.for(m[1]).getErrorCtor(m)??Error,g=new u(h),y={};for(const[w,b]of a.structIterator()){const R=b.getMergedTraits().jsonName??w;y[w]=this.codec.createDeserializer().readObject(b,r[R])}throw this.awsQueryCompatible&&this.mixin.queryCompatOutput(r,y),this.mixin.decorateServiceException(Object.assign(g,n,{$fault:a.getMergedTraits().error,message:h},y),r)}}class ee extends H{constructor({defaultNamespace:i,serviceTarget:t,awsQueryCompatible:e,jsonCodec:o}){super({defaultNamespace:i,serviceTarget:t,awsQueryCompatible:e,jsonCodec:o})}getShapeId(){return"aws.protocols#awsJson1_1"}getJsonRpcVersion(){return"1.1"}getDefaultContentType(){return"application/x-amz-json-1.1"}}export{ee as A};
