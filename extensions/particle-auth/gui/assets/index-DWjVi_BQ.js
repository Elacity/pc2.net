import{c as R,A as x,S as W}from"./loadSts-Ba1usvSK.js";import{b as G,E as H,e as q,I as J,d as Q,M as X,P as Y,R as Z,a as U}from"./loadSts-Ba1usvSK.js";import{C as T,g as b,s as C}from"./index-C8GBMcfL.js";import{a as O}from"./index-C8GBMcfL.js";import"./date-utils-pKr_beww.js";import"./noAuth-BRTlyyWt.js";import"./index-CJ2_VouK.js";function h(){return async()=>"us-east-1"}class w extends T.classBuilder().ep(R).m(function(n,o,i,t){return[b(i,n.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRoleWithWebIdentity",{}).n("STSClient","AssumeRoleWithWebIdentityCommand").sc(x).build(){}const D=e=>{if(typeof(e==null?void 0:e.Arn)=="string"){const n=e.Arn.split(":");if(n.length>4&&n[4]!=="")return n[4]}},k=async(e,n,o,i={})=>{var a;const t=typeof e=="function"?await e():e,r=typeof n=="function"?await n():n,c=await h()();return(a=o==null?void 0:o.debug)==null||a.call(o,"@aws-sdk/client-sts::resolveRegion","accepting first of:",`${t} (credential provider clientConfig)`,`${r} (contextual client)`,`${c} (STS default: AWS_REGION, profile region, or us-east-1)`),t??r??c},K=(e,n)=>{let o;return async i=>{var l,u,m,f,d;if(!o){const{logger:S=(l=e==null?void 0:e.parentClientConfig)==null?void 0:l.logger,profile:A=(u=e==null?void 0:e.parentClientConfig)==null?void 0:u.profile,region:I,requestHandler:s=(m=e==null?void 0:e.parentClientConfig)==null?void 0:m.requestHandler,credentialProviderLogger:y,userAgentAppId:E=(f=e==null?void 0:e.parentClientConfig)==null?void 0:f.userAgentAppId}=e,g=await k(I,(d=e==null?void 0:e.parentClientConfig)==null?void 0:d.region,y,{}),p=!_(s);o=new n({...e,userAgentAppId:E,profile:A,region:g,requestHandler:p?s:void 0,logger:S})}const{Credentials:t,AssumedRoleUser:r}=await o.send(new w(i));if(!t||!t.AccessKeyId||!t.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRoleWithWebIdentity call with role ${i.RoleArn}`);const c=D(r),a={accessKeyId:t.AccessKeyId,secretAccessKey:t.SecretAccessKey,sessionToken:t.SessionToken,expiration:t.Expiration,...t.CredentialScope&&{credentialScope:t.CredentialScope},...c&&{accountId:c}};return c&&C(a,"RESOLVED_ACCOUNT_ID","T"),C(a,"CREDENTIALS_STS_ASSUME_ROLE_WEB_ID","k"),a}},_=e=>{var n;return((n=e==null?void 0:e.metadata)==null?void 0:n.handlerProtocol)==="h2"},$=(e,n)=>n?class extends e{constructor(i){super(i);for(const t of n)this.middlewareStack.use(t)}}:e,F=(e={},n)=>K(e,$(W,n));export{T as $Command,G as AssumeRoleCommand,w as AssumeRoleWithWebIdentityCommand,H as ExpiredTokenException,q as IDPCommunicationErrorException,J as IDPRejectedClaimException,Q as InvalidIdentityTokenException,X as MalformedPolicyDocumentException,Y as PackedPolicyTooLargeException,Z as RegionDisabledException,W as STSClient,U as STSServiceException,O as __Client,F as getDefaultRoleAssumerWithWebIdentity};
