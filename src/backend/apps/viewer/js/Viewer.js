let history_index_at_last_save=0,unsavedChanges=!1,curfile,editor;async function attempt_exit(){var alert_resp;$(editor).pintura("history").index===history_index_at_last_save||"Don't Save"===(alert_resp=await puter.ui.alert("Do you want to save the changes you made?",[{label:"Save",type:"primary"},{label:"Don't Save"},{label:"Cancel"}]))?puter.exit():"Save"===alert_resp&&(curfile?save_file(()=>{puter.exit()}):(filename=res.filename,read_url=res.read_url,write_url=res.write_url,unsavedChanges=!1,puter.ui.setWindowTitle(filename),puter.exit()))}async function save_file(callback){var image=(await $(editor).pintura("processImage")).dest;await curfile.write(image),unsavedChanges=!1,puter.ui.setWindowTitle(curfile.name),history_index_at_last_save=$(editor).pintura("history").index,$("#save-btn").prop("disabled",!0),void 0!==callback&&callback(this.responseJSON)}function open_file(cfile){curfile=cfile,$(editor).pintura("loadImage",curfile.readURL)}$(document).ready(function(){useEditorWithJQuery(jQuery,pintura),editor=$(".my-editor").pinturaDefault({src:curfile?curfile.readURL:void 0,enableButtonExport:!1,imageWriter:{}}),$(editor).on("pintura:update",function(event){unsavedChanges=history_index_at_last_save!==$(editor).pintura("history").index,setTimeout(()=>{history_index_at_last_save!==$(editor).pintura("history").index?$("#save-btn").prop("disabled",!1):$("#save-btn").prop("disabled",!0)},100)}),puter.ui.onItemsOpened(async function(items){var alert_resp;!unsavedChanges||"Don't Save"===(alert_resp=await puter.ui.alert("Do you want to save the changes you made?",[{label:"Save",type:"primary"},{label:"Don't Save"},{label:"Cancel"}]))?(curfile=items[0],unsavedChanges=!1,open_file(curfile)):"Save"===alert_resp&&(void 0===write_url?(await puter.ui.showSaveFilePicker(editor.getValue(),curfile.name),curfile=items[0],unsavedChanges=!1,open_file(curfile)):save_file(()=>{curfile=items[0],unsavedChanges=!1,open_file(curfile)}))}),puter.ui.onWindowClose(()=>{attempt_exit()})}),$("#save-btn").on("click",function(){$("#save-btn").prop("disabled",!0),save_file()});